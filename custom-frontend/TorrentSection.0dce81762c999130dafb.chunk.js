"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[74452],{78165:function(e,t,n){n.r(t),n.d(t,{Component:function(){return K}});var r=n(62540),o=n(63696),a=n(92779),i=n(57836),s=n(63703),l=n(28335),c=n(35117),u=n(60434),d=n(70564),h=n(10822),x=n(89348),f=n(69856),p=n(74156),y=n(57962),m=n(47891),A=n(2066),v=n(37631),g=n(31858),b=n(75487),j=n(13786),w=n(91520),S=n(62010),C=n(98756),k=n(37793),T=n(75720),N=n(9042),D=n(31720),I=n(82670),F=n(76745),P=n(85637),B=n(87404),E=n(5898),L=n(8566),U=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},z=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},M=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},O=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},R=function(e){if(0===e)return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,t)).toFixed(2))," ").concat(["Bytes","KB","MB","GB","TB"][t])},W=function(e){return e?new Date("string"==typeof e?1e3*Number(e):1e3*e).toLocaleDateString():""},G=function(e){if(0===e)return"0 B/s";for(var t=["B/s","KB/s","MB/s","GB/s"],n=e,r=0;n>=1024&&r<t.length-1;)n/=1024,r++;return"".concat(n.toFixed(2)," ").concat(t[r])},J=function(e){if(e<=0||e>=864e4)return"Unknown";var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return t>0?"".concat(t,"h ").concat(n,"m"):n>0?"".concat(n,"m ").concat(r,"s"):"".concat(r,"s")},K=function(){var e=(0,B.zy)(),t=(0,o.useRef)(null);if("/dashboard/TorrentSection"!==e.pathname&&"/dashboard/TorrentSection/"!==e.pathname)return console.log("TorrentSection not rendering - wrong path:",e.pathname),null;var n=M((0,o.useState)(""),2),K=n[0],_=n[1],H=M((0,o.useState)([]),2),q=H[0],Q=H[1],V=M((0,o.useState)([]),2),X=V[0],Y=V[1],Z=M((0,o.useState)(!1),2),$=Z[0],ee=Z[1],te=M((0,o.useState)(!1),2),ne=te[0],re=te[1],oe=M((0,o.useState)(0),2),ae=(oe[0],oe[1]),ie=M((0,o.useState)(null),2),se=ie[0],le=ie[1],ce=M((0,o.useState)([]),2),ue=ce[0],de=ce[1],he=M((0,o.useState)(!1),2),xe=he[0],fe=he[1],pe=M((0,o.useState)(null),2),ye=pe[0],me=pe[1],Ae=M((0,o.useState)([]),2),ve=Ae[0],ge=Ae[1],be=M((0,o.useState)(""),2),je=be[0],we=be[1],Se=M((0,o.useState)(!1),2),Ce=Se[0],ke=Se[1],Te=M((0,o.useState)(null),2),Ne=Te[0],De=Te[1],Ie=M((0,o.useState)(!1),2),Fe=Ie[0],Pe=Ie[1],Be=(0,o.useCallback)((function(){return U(void 0,void 0,void 0,(function(){var e,t,n,r;return z(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,3,4]),ke(!0),e=window.ApiClient.getUrl("torrent/libraries"),[4,window.ApiClient.getJSON(e)];case 1:return t=o.sent(),ge(t||[]),(null==t?void 0:t.length)>0&&(null===(r=t[0].Paths)||void 0===r?void 0:r.length)>0&&we(t[0].Paths[0]),[3,4];case 2:return n=o.sent(),console.error("Failed to fetch libraries:",n),le("Failed to fetch libraries: ".concat(n instanceof Error?n.message:String(n))),[3,4];case 3:return ke(!1),[7];case 4:return[2]}}))}))}),[]),Ee=(0,o.useCallback)((function(){return U(void 0,void 0,void 0,(function(){var e,t,n;return z(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,3,4]),fe(!0),me(null),e=window.ApiClient.getUrl("torrent/progress"),[4,window.ApiClient.getJSON(e)];case 1:return t=r.sent(),de(t||[]),[3,4];case 2:return n=r.sent(),console.error("Failed to fetch torrent progress:",n),me("Progress update failed: ".concat(n instanceof Error?n.message:String(n))),[3,4];case 3:return fe(!1),[7];case 4:return[2]}}))}))}),[]);(0,o.useEffect)((function(){return console.log("TorrentSection mounted"),Ee(),Be(),t.current=setInterval((function(){Ee()}),3e3),function(){console.log("TorrentSection unmounting"),t.current&&clearInterval(t.current)}}),[Ee,Be]);var Le=(0,o.useCallback)((function(){return U(void 0,void 0,void 0,(function(){var e,t,n;return z(this,(function(r){switch(r.label){case 0:if(!K.trim())return[2];console.log("Searching for:",K),ee(!0),Q([]),le(null),L.Ay.show(),r.label=1;case 1:return r.trys.push([1,3,4,5]),e=window.ApiClient.getUrl("torrent/search",{q:K}),[4,window.ApiClient.getJSON(e)];case 2:return t=r.sent(),Q(t||[]),[3,5];case 3:return n=r.sent(),console.error("Search failed:",n),le("Search failed: ".concat(n instanceof Error?n.message:String(n))),[3,5];case 4:return ee(!1),L.Ay.hide(),[7];case 5:return[2]}}))}))}),[K]),Ue=(0,o.useCallback)((function(e){Y((function(t){return t.some((function(t){return t.Id===e.Id}))?t.filter((function(t){return t.Id!==e.Id})):O(O([],M(t),!1),[e],!1)}))}),[]),ze=(0,o.useCallback)((function(){return U(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,s;return z(this,(function(l){switch(l.label){case 0:if(0===X.length)return[2];if(!je)return le("Please select a download location"),[2];console.log("Downloading selected items to:",je),re(!0),ae(0),le(null),L.Ay.show(),l.label=1;case 1:l.trys.push([1,10,11,12]),l.label=2;case 2:l.trys.push([2,7,8,9]),e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(X),t=e.next(),l.label=3;case 3:return t.done?[3,6]:(n=t.value,r=window.ApiClient.getUrl("torrent/download"),[4,window.ApiClient.ajax({type:"POST",url:r,data:JSON.stringify({Info_hash:n.Info_hash,Name:n.Name,SavePath:je}),contentType:"application/json"})]);case 4:l.sent(),l.label=5;case 5:return t=e.next(),[3,3];case 6:return[3,9];case 7:return o=l.sent(),i={error:o},[3,9];case 8:try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(i)throw i.error}return[7];case 9:return Ee(),Y([]),[3,12];case 10:return a=l.sent(),console.error("Download failed:",a),le("Download failed: ".concat(a instanceof Error?a.message:String(a))),[3,12];case 11:return setTimeout((function(){re(!1),ae(0),L.Ay.hide()}),1e3),[7];case 12:return[2]}}))}))}),[X,je,Ee]),Me=(0,o.useCallback)((function(e){return U(void 0,void 0,void 0,(function(){var t,n;return z(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=window.ApiClient.getUrl("torrent/pause",{hash:e}),[4,window.ApiClient.ajax({type:"POST",url:t})];case 1:return r.sent(),Ee(),[3,3];case 2:return n=r.sent(),console.error("Failed to pause torrent:",n),me("Failed to pause torrent: ".concat(n instanceof Error?n.message:String(n))),[3,3];case 3:return[2]}}))}))}),[Ee]),Oe=(0,o.useCallback)((function(e){return U(void 0,void 0,void 0,(function(){var t,n;return z(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=window.ApiClient.getUrl("torrent/resume",{hash:e}),[4,window.ApiClient.ajax({type:"POST",url:t})];case 1:return r.sent(),Ee(),[3,3];case 2:return n=r.sent(),console.error("Failed to resume torrent:",n),me("Failed to resume torrent: ".concat(n instanceof Error?n.message:String(n))),[3,3];case 3:return[2]}}))}))}),[Ee]),Re=(0,o.useCallback)((function(e){return U(void 0,void 0,void 0,(function(){var t,n;return z(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=window.ApiClient.getUrl("torrent/delete",{hash:e}),[4,window.ApiClient.ajax({type:"POST",url:t})];case 1:return r.sent(),Ee(),[3,3];case 2:return n=r.sent(),console.error("Failed to delete torrent:",n),me("Failed to delete torrent: ".concat(n instanceof Error?n.message:String(n))),[3,3];case 3:return[2]}}))}))}),[Ee]),We=(0,o.useCallback)((function(e){De(e),Pe(!0)}),[]),Ge=(0,o.useCallback)((function(){De(null),Pe(!1)}),[]),Je=(0,o.useCallback)((function(){Ne&&(Re(Ne),De(null),Pe(!1))}),[Re,Ne]);return(0,r.jsxs)("div",{style:{position:"absolute",top:0,left:"var(--sidebar-width, 240px)",right:0,bottom:0,backgroundColor:"var(--theme-background, #000)",zIndex:2,overflow:"auto",padding:"20px",pointerEvents:"auto"},children:[(0,r.jsx)("div",{className:"sectionTitleContainer flex align-items-center",children:(0,r.jsx)("h2",{className:"sectionTitle",children:E.Ay.translate("Torrent")})}),se&&(0,r.jsx)(m.A,{severity:"error",sx:{mb:2},children:se}),(0,r.jsx)(x.A,{variant:"h6",gutterBottom:!0,children:E.Ay.translate("ActiveTorrents")}),ye&&(0,r.jsx)(m.A,{severity:"error",sx:{mb:2},children:ye}),(0,r.jsxs)(a.A,{sx:{mb:4},children:[xe&&0===ue.length&&(0,r.jsx)(h.A,{sx:{width:"100%",mb:2}}),0===ue.length&&!xe&&(0,r.jsx)(f.A,{elevation:1,sx:{p:2,textAlign:"center"},children:(0,r.jsx)(x.A,{children:"No active torrents"})}),(0,r.jsx)(y.Ay,{container:!0,spacing:2,children:ue.map((function(e){return(0,r.jsx)(y.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,r.jsx)(j.A,{variant:"outlined",sx:{height:"100%",position:"relative",border:"1px solid rgba(255, 255, 255, 0.12)"},children:(0,r.jsxs)(w.A,{children:[(0,r.jsx)(x.A,{variant:"subtitle1",noWrap:!0,title:e.name,sx:{mb:1,fontWeight:"bold"},children:e.name}),(0,r.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,r.jsx)(a.A,{sx:{width:"100%",mr:1},children:(0,r.jsx)(h.A,{variant:"determinate",value:100*e.progress,sx:{height:8,borderRadius:1,"& .MuiLinearProgress-bar":{bgcolor:e.state.includes("DL")?"primary.main":"success.main"}}})}),(0,r.jsx)(a.A,{sx:{minWidth:45},children:(0,r.jsxs)(x.A,{variant:"body2",color:"text.secondary",children:[(100*e.progress).toFixed(1),"%"]})})]}),(0,r.jsxs)(y.Ay,{container:!0,spacing:1,children:[(0,r.jsx)(y.Ay,{item:!0,xs:6,children:(0,r.jsxs)(x.A,{variant:"body2",color:"text.secondary",children:["Status: ",(0,r.jsx)(x.A,{component:"span",variant:"body2",color:"text.primary",children:"downloading"===e.state?"Downloading":"uploading"===e.state?"Seeding":"pausedDL"===e.state?"Paused":"stoppedDL"===e.state?"Stopped":e.state})]})}),(0,r.jsx)(y.Ay,{item:!0,xs:6,children:(0,r.jsxs)(x.A,{variant:"body2",color:"text.secondary",children:["Size: ",(0,r.jsx)(x.A,{component:"span",variant:"body2",color:"text.primary",children:R(e.size)})]})}),(0,r.jsx)(y.Ay,{item:!0,xs:6,children:(0,r.jsxs)(x.A,{variant:"body2",color:"text.secondary",children:["Down: ",(0,r.jsx)(x.A,{component:"span",variant:"body2",color:"text.primary",children:G(e.dlspeed)})]})}),(0,r.jsx)(y.Ay,{item:!0,xs:6,children:(0,r.jsxs)(x.A,{variant:"body2",color:"text.secondary",children:["Up: ",(0,r.jsx)(x.A,{component:"span",variant:"body2",color:"text.primary",children:G(e.upspeed)})]})}),(0,r.jsx)(y.Ay,{item:!0,xs:6,children:(0,r.jsxs)(x.A,{variant:"body2",color:"text.secondary",children:["ETA: ",(0,r.jsx)(x.A,{component:"span",variant:"body2",color:"text.primary",children:J(e.eta)})]})}),(0,r.jsx)(y.Ay,{item:!0,xs:6,children:(0,r.jsxs)(x.A,{variant:"body2",color:"text.secondary",children:["Added: ",(0,r.jsx)(x.A,{component:"span",variant:"body2",color:"text.primary",children:W(e.added_on)})]})})]}),(0,r.jsxs)(a.A,{sx:{mt:2,display:"flex",justifyContent:"flex-end",gap:1},children:["pausedDL"===e.state||"stoppedDL"===e.state?(0,r.jsx)(b.A,{size:"small",color:"primary",onClick:function(){return Oe(e.hash)},title:"Resume",children:(0,r.jsx)(A.A,{})}):(0,r.jsx)(b.A,{size:"small",color:"primary",onClick:function(){return Me(e.hash)},title:"Pause",children:(0,r.jsx)(v.A,{})}),(0,r.jsx)(b.A,{size:"small",color:"error",onClick:function(){return We(e.hash)},title:"Delete",children:(0,r.jsx)(g.A,{})})]})]})})},e.hash)}))})]}),(0,r.jsx)(p.A,{sx:{my:3}}),(0,r.jsx)(x.A,{variant:"h6",gutterBottom:!0,children:E.Ay.translate("SearchTorrents")}),(0,r.jsxs)(f.A,{elevation:2,sx:{p:2,mb:3,display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(i.A,{label:E.Ay.translate("SearchTerm"),variant:"outlined",fullWidth:!0,value:K,onChange:function(e){return _(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&Le()},disabled:$||ne}),(0,r.jsx)(s.A,{variant:"contained",onClick:Le,disabled:$||ne||!K.trim(),children:E.Ay.translate("Search")})]}),(0,r.jsxs)(y.Ay,{container:!0,spacing:3,children:[(0,r.jsxs)(y.Ay,{item:!0,xs:12,md:7,children:[(0,r.jsxs)(x.A,{variant:"h6",gutterBottom:!0,children:[E.Ay.translate("SearchResults"),q.length>0&&" (".concat(q.length,")")]}),(0,r.jsxs)(f.A,{elevation:1,sx:{maxHeight:"50vh",overflow:"auto"},children:[$&&(0,r.jsx)(h.A,{sx:{width:"100%"}}),(0,r.jsxs)(l.A,{dense:!0,children:[0===q.length&&!$&&(0,r.jsx)(c.Ay,{children:(0,r.jsx)(u.A,{primary:E.Ay.translate("NoResultsEnterSearch")})}),q.map((function(e){return(0,r.jsx)(c.Ay,{secondaryAction:(0,r.jsx)(d.A,{edge:"end",onChange:function(){return Ue(e)},checked:X.some((function(t){return t.Id===e.Id})),disabled:ne}),disablePadding:!0,children:(0,r.jsx)(a.A,{sx:{flexGrow:1,cursor:"pointer",p:1},onClick:function(){return Ue(e)},children:(0,r.jsx)(u.A,{primary:e.Name,secondary:(0,r.jsxs)(o.Fragment,{children:[(0,r.jsx)(x.A,{component:"span",variant:"body2",color:"text.primary",children:"".concat(Number(e.Seeders).toLocaleString()," seeders • ").concat(Number(e.Leechers).toLocaleString()," leechers")}),(0,r.jsx)("br",{}),(0,r.jsx)(x.A,{component:"span",variant:"body2",children:"".concat(R(Number(e.Size))," • ").concat(W(e.Added))}),e.Username&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("br",{}),(0,r.jsx)(x.A,{component:"span",variant:"body2",children:"Uploader: ".concat(e.Username)})]})]})})})},e.Id)}))]})]})]}),(0,r.jsxs)(y.Ay,{item:!0,xs:12,md:5,children:[(0,r.jsxs)(x.A,{variant:"h6",gutterBottom:!0,children:[E.Ay.translate("SelectedForDownload"),X.length>0&&" (".concat(X.length,")")]}),(0,r.jsx)(f.A,{elevation:1,sx:{maxHeight:"50vh",overflow:"auto"},children:(0,r.jsxs)(l.A,{dense:!0,children:[0===X.length&&(0,r.jsx)(c.Ay,{children:(0,r.jsx)(u.A,{primary:E.Ay.translate("NoItemsSelected")})}),X.map((function(e){return(0,r.jsxs)(c.Ay,{children:[(0,r.jsx)(u.A,{primary:e.Name,secondary:"".concat(R(Number(e.Size)))}),(0,r.jsx)(s.A,{size:"small",color:"error",onClick:function(){return Ue(e)},children:E.Ay.translate("Remove")})]},e.Id)}))]})})]})]}),(0,r.jsx)(p.A,{sx:{my:3}}),(0,r.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[(0,r.jsx)(a.A,{sx:{width:"100%",maxWidth:500,mb:2},children:(0,r.jsxs)(D.A,{fullWidth:!0,variant:"outlined",children:[(0,r.jsx)(I.A,{id:"download-location-label",children:"Download Location"}),(0,r.jsx)(F.A,{labelId:"download-location-label",value:je,onChange:function(e){return we(e.target.value)},label:"Download Location",disabled:ne||Ce||0===ve.length,children:ve.flatMap((function(e){return e.Paths.map((function(t){return(0,r.jsx)(P.A,{value:t,children:"".concat(e.Name,": ").concat(t)},"".concat(e.Name,"-").concat(t))}))}))})]})}),(0,r.jsx)(s.A,{variant:"contained",color:"primary",onClick:ze,disabled:0===X.length||ne||$||!je,size:"large",children:E.Ay.translate("DownloadSelected")}),ne&&(0,r.jsxs)(a.A,{sx:{width:"50%",mt:1},children:[(0,r.jsx)(h.A,{variant:"indeterminate"}),(0,r.jsx)(x.A,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:.5},children:"Adding torrents..."})]})]}),(0,r.jsxs)(S.A,{open:Fe,onClose:Ge,children:[(0,r.jsx)(N.A,{children:"Delete Torrent"}),(0,r.jsx)(k.A,{children:(0,r.jsx)(T.A,{children:"Are you sure you want to delete this torrent? This action cannot be undone."})}),(0,r.jsxs)(C.A,{children:[(0,r.jsx)(s.A,{onClick:Ge,children:"Cancel"}),(0,r.jsx)(s.A,{onClick:Je,color:"error",autoFocus:!0,children:"Delete"})]})]})]})};K.displayName="TorrentSectionPage"}}]);